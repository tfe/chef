<h1>Chef: an order processing system</h1>

<h2>History and Background</h2>
<p>This app was written in the summer of 2008 primarily by Todd Eichel (todd@toddeichel.com) with input from Can Duruk.</p>

<p>The original purpose of the application was three-fold:</p>
<ul>
  <li>Capture web store notification emails from CMU's credit card payment/processing system and parse out the order data</li>
  <li>Send the customer an order confirmation email</li>
  <li>Do something useful with the order data</li>
</ul>

<p>So the project was started with the intent to build a system to do the above three things.  Scope was intentionally limited to that level so that the app might stand a chance of actually being finished.  Plenty of ideas were generated for future versions in the process.</p>

<p>An emphasis was placed on simplicity, limited scope, use of existing code and plugins where possible, DRY and RESTful design, and best-practices use of the Rails framework, with an eye towards future interoperability and extensibility.</p>


<h2>Data Flow</h2>
<p>This is how data flows into, through, and out of the application:</p>
<ol>
  <li>When an order is placed (or attempted, CC validation failures are sent also), CMU's order processing system sends a notification email to the address passed to it with the order data (see: http://cmutv.grouphub.com/projects/2243749/msg/cat/22372554/14888159/comments). For this to work, this must be set to the same mailbox that the app is checking (store@cmutv.org, configurable in /config/mail_fetcher.yml).
  <li>The application checks the store@cmutv.org mailbox over IMAP using the credentials in /config/mail_fetcher.yml.</li>
  <li>Emails found to be from the CMU order processing system (using the address listed in /config/config.yml) are fetched, stored in the database, and moved to the IMAP folder 'Chef - Fetched' (folder name set in /config/mail_fetcher.yml).</li>
  <li>Emails not found to be from the order processing system are moved to the IMAP folder 'INBOX' (also configured in /config/mail_fetcher.yml), effectively leaving them where they are. This logic is implemented in the ActionMailer receive method, which returns normally if the message should be fetched and throws an exception if it should be left in the inbox.</li>
  <li>Before emails are created (saved to the database for the first time), parse_to_order is called on them. This goes through the email and pulls out the billing/shipping data, and the line items and products in the order.</li>
  <li>Before orders are created (saved to the database for the first time), deliver_confirmation is called on them (this is implemented in the ActionMailer).  This delivers a confirmation email to the customer through Gmail's SMTP servers with store@cmutv.org's credentials (stored in in /config/config.yml).  The subject, from address, reply-to, etc. are customizable in /config/config.yml.</li>
</ol>


<h2>Version History</h2>

<h3>1.0</h3>
<ul>
  <li>fetch emails, store in database</li>
  <li>parse emails and create orders</li>
  <li>send confirmation email to customer</li>
  <li>post order information to basecamp or google docs</li>
</ul>
  